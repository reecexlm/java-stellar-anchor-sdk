version: 0.2
env:
  variables:
    environment: "dev"
  secrets-manager:
    DOCKER_LOGIN_PW: "/CodeBuild/dockerLoginPassword"     
phases:
  build:
    commands:
      - docker login -u reecemarkowsky -p $DOCKER_LOGIN_PW
      - cd docs/resources/deployment-examples/aws-fargate-ecs
      - aws s3 cp s3://anchorconfig/anchor_config.yaml .
      - aws s3 cp s3://anchorconfig/stellar.toml ./stellar_wks.toml
      - aws s3 cp s3://anchorconfig/reference_config.yaml .
      - mkdir /config
      - aws ecr get-login-password --region us-east-2 | docker login --username AWS --password-stdin 245943599471.dkr.ecr.us-east-2.amazonaws.com
      - docker build . -t anchor-config
      - docker tag anchor-config 245943599471.dkr.ecr.us-east-2.amazonaws.com/anchor-platform-config:latest
      - docker push 245943599471.dkr.ecr.us-east-2.amazonaws.com/anchor-platform-config:latest

