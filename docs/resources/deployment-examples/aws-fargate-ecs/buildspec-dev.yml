version: 0.2
env:
  variables:
    environment: "dev"
  secrets-manager:
    DOCKER_LOGIN_PW: "/CodeBuild/dockerLoginPassword"     
phases:
  build:
    commands:
      - docker login -u reecemarkowsky -p $DOCKER_LOGIN_PW
      - cd docs/resources/deployment-examples/aws-fargate-ecs
      - aws s3 cp s3://anchorplatformhelmchart/anchor_config.yaml .
      - aws s3 cp s3://anchorplatformhelmchart/stellar.toml .
      - mkdir /config
      - cp ./stellar.toml /config/stellar-wks.toml
      - cp ./anchor_config.yaml /config
      - docker build . -t anchor-config
      - docker tag anchor-config 245943599471.dkr.ecr.us-east-2.amazonaws.com/anchor-platform-config:latest
      - docker push 245943599471.dkr.ecr.us-east-2.amazonaws.com/anchor-platform-config:latest
